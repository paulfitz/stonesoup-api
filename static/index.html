<!DOCHTML>
<html>
  <head>
    <meta charset="utf-8" /> 
  </head>
  <body>

    <script>
     function formatParams(params){
       return "?" + Object
        .keys(params)
        .map(function(key){
          return key+"="+encodeURIComponent(params[key])
        })
        .join("&");
     }
     function apply(verb, path, args) {
       const response = document.getElementById('response');
       response.classList.add('loading');
       var request = new XMLHttpRequest();
       request.onreadystatechange = function() {
         if (request.readyState === XMLHttpRequest.DONE) {
           console.log(request.responseText);
           response.innerHTML = JSON.stringify(
             JSON.parse(request.responseText), null, 2);
           response.classList.remove('loading');
         }
       }
       request.open(verb, path, true);
       request.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
       request.send(JSON.stringify(args));
       //request.open(verb, path + formatParams(args), true);
       //request.send();
     }
     function run() {
       const v = {};
       const fields = ['key', 'city'];
       for (let i=0; i<fields.length; i++) {
         v[fields[i]] = document.getElementById(fields[i]).value
       }
       v.verbose = true;
       console.log(v);
       apply('POST', '/search', v);
     }
    </script>

    Hello worldddds.

    <form action="search" onsubmit="run(); return false"">
      city <input type="text" name="city" id="city" onchange="run(); return false" />
      keyword <input type="text" name="key" id="key" onchange="run(); return false" />
      <input type="button" name="search" value="search" onclick="run(); return false" />
    </form>

    <div id="response">
    </div>

  </body>
</html>

